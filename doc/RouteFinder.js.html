<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: travel/search/RouteFinder.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: travel/search/RouteFinder.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>"use strict";

var RouteChromosomeSplicer = require("./RouteChromosomeSplicer");
var RouteIncubator = require("./RouteIncubator");
var RouteList = require("./RouteList");

/**
 * A finder of a route, consisting of a start path, a list of waypoints and an
 * optional destination. The order of the waypoints will be optimized during
 * the search.
 *
 * @constructor
 * @param {everoute.travel.search.RouteFinderBuilder} builder the builder with all parameters
 * @memberof everoute.travel.search
 */
function RouteFinder(builder) {
  var self = this;

  function onRouteFound(route) {
    self.onRouteFound(route);
  }

  this.rand = builder.getRandomizer();
  this.rule = builder.getRule();

  this.splicer = new RouteChromosomeSplicer(this.rand);
  this.population = new RouteList(this.rule);
  this.incubator = new RouteIncubator(onRouteFound, builder.getCapability(), this.rule,
    builder.getWaypoints(), builder.getDestination(), this.rand);

  this.startPaths = builder.getStartPaths().slice(0);
  this.waypoints = builder.getWaypoints().slice(0);
  this.collector = builder.getCollector();

  this.populationLimit = builder.getPopulationLimit();
  this.generationLimit = builder.getGenerationLimit();
  this.mutationPercentage = builder.getMutationPercentage();
  this.uncontestedLimit = this.generationLimit / 4;

  this.generationCount = 0;
  this.uncontestedCount = 0;

  this.bestRoute = null;
}

/**
 * Continues the search. This method should be called until it returned false.
 *
 * @return {Boolean} false if the search is completed
 * @memberof! everoute.travel.search.RouteFinder.prototype
 */
RouteFinder.prototype.continueSearch = function() {
  var result = false;

  if ((this.generationCount &lt; this.generationLimit) && (this.uncontestedCount &lt; this.uncontestedLimit)) {
    result = true;
    if (!this.incubator.continueGrowth()) {
      this.generationCount++;
      this.uncontestedCount++;

      this.ensurePopulationSize();
      this.createOffsprings();
    }
  }

  return result;
};

/**
 * Called when a route was found.
 *
 * @private
 * @param {everoute.travel.search.Route} route The found route
 * @memberof! everoute.travel.search.RouteFinder.prototype
 */
RouteFinder.prototype.onRouteFound = function(route) {
  var isBest = this.population.add(route);

  if (isBest) {
    this.uncontestedCount = 0;
    this.collector.collect(route);
  }
};

/**
 * Ensures a properly sized population.
 *
 * @private
 * @memberof! everoute.travel.search.RouteFinder.prototype
 */
RouteFinder.prototype.ensurePopulationSize = function() {
  var missing;

  this.population.limit(this.populationLimit);

  missing = this.populationLimit - this.population.getSize();
  while (missing > 0) {
    this.incubator.request(this.createRandomChromosome());
    missing--;
  }
};

/**
 * @private
 * @return {{}} A new, random chromosome
 * @memberof! everoute.travel.search.RouteFinder.prototype
 */
RouteFinder.prototype.createRandomChromosome = function() {
  return this.splicer.createRandom(this.startPaths, this.waypoints.length);
};

/**
 * Creates offsprings from the current population.
 *
 * @private
 * @memberof! everoute.travel.search.RouteFinder.prototype
 */
RouteFinder.prototype.createOffsprings = function() {
  var size = this.population.getSize();
  var crossoverIndex = this.rand.getIndex(this.waypoints.length + 1);
  var shouldMutate = this.rand.getIndex(100) &lt; this.mutationPercentage;
  var parent1;
  var parent2;

  if (size >= 2) {
    parent1 = this.population.get(this.rand.getIndex(size)).getChromosome();
    parent2 = this.population.get(this.rand.getIndex(size)).getChromosome();

    if (shouldMutate) {
      this.createMutatedOffsprings(parent1, parent2, crossoverIndex);
    } else {
      this.incubator.request(this.splicer.createOffspring(parent1, parent2, crossoverIndex));
      this.incubator.request(this.splicer.createOffspring(parent2, parent1, crossoverIndex));
    }
  }
};

/**
 * Creates mutated offsprings using given parameters. The parents are spliced with
 * a new, random chromosome at the given crossover index.
 *
 * @private
 * @param {{}} parent1 The first chromosome
 * @param {{}} parent2 The second chromosome
 * @param {Number} crossoverIndex The waypoint index at which to splice
 * @memberof! everoute.travel.search.RouteFinder.prototype
 */
RouteFinder.prototype.createMutatedOffsprings = function(parent1, parent2, crossoverIndex) {
  var randomChromosome = this.createRandomChromosome();

  this.incubator.request(this.splicer.createOffspring(parent1, randomChromosome, crossoverIndex));
  this.incubator.request(this.splicer.createOffspring(randomChromosome, parent1, crossoverIndex));
  this.incubator.request(this.splicer.createOffspring(parent2, randomChromosome, crossoverIndex));
  this.incubator.request(this.splicer.createOffspring(randomChromosome, parent2, crossoverIndex));
};

module.exports = RouteFinder;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="everoute.travel.AddingTravelCost.html">AddingTravelCost</a></li><li><a href="everoute.travel.AnyLocation.html">AnyLocation</a></li><li><a href="everoute.travel.capabilities.CombiningTravelCapability.html">CombiningTravelCapability</a></li><li><a href="everoute.travel.capabilities.jumpGate.JumpGateTravelCapability.html">JumpGateTravelCapability</a></li><li><a href="everoute.travel.capabilities.OptimizingTravelCapability.html">OptimizingTravelCapability</a></li><li><a href="everoute.travel.capabilities.TravelCapability.html">TravelCapability</a></li><li><a href="everoute.travel.Jump.html">Jump</a></li><li><a href="everoute.travel.JumpBuilder.html">JumpBuilder</a></li><li><a href="everoute.travel.Location.html">Location</a></li><li><a href="everoute.travel.ManufacturingPathContestProvider.html">ManufacturingPathContestProvider</a></li><li><a href="everoute.travel.Path.html">Path</a></li><li><a href="everoute.travel.PathContest.html">PathContest</a></li><li><a href="everoute.travel.PathContestProvider.html">PathContestProvider</a></li><li><a href="everoute.travel.rules.MaxSecurityTravelRule.html">MaxSecurityTravelRule</a></li><li><a href="everoute.travel.rules.MinSecurityTravelRule.html">MinSecurityTravelRule</a></li><li><a href="everoute.travel.rules.NaturalOrderTravelRule.html">NaturalOrderTravelRule</a></li><li><a href="everoute.travel.rules.TravelRule.html">TravelRule</a></li><li><a href="everoute.travel.rules.TravelRuleset.html">TravelRuleset</a></li><li><a href="everoute.travel.search.DestinationSystemSearchCriterion.html">DestinationSystemSearchCriterion</a></li><li><a href="everoute.travel.search.PathFinder.html">PathFinder</a></li><li><a href="everoute.travel.search.Route.html">Route</a></li><li><a href="everoute.travel.search.RouteFinder.html">RouteFinder</a></li><li><a href="everoute.travel.search.RouteFinderBuilder.html">RouteFinderBuilder</a></li><li><a href="everoute.travel.search.SearchCriterion.html">SearchCriterion</a></li><li><a href="everoute.travel.search.SearchResultCollector.html">SearchResultCollector</a></li><li><a href="everoute.travel.SpecificLocation.html">SpecificLocation</a></li><li><a href="everoute.travel.StaticPathContestProvider.html">StaticPathContestProvider</a></li><li><a href="everoute.travel.Step.html">Step</a></li><li><a href="everoute.travel.StepBuilder.html">StepBuilder</a></li><li><a href="everoute.travel.TravelCost.html">TravelCost</a></li><li><a href="everoute.travel.TravelCostSum.html">TravelCostSum</a></li><li><a href="everoute.universe.EmptySolarSystem.html">EmptySolarSystem</a></li><li><a href="everoute.universe.EmptyUniverse.html">EmptyUniverse</a></li><li><a href="everoute.universe.ExtendedSolarSystem.html">ExtendedSolarSystem</a></li><li><a href="everoute.universe.ExtendedUniverse.html">ExtendedUniverse</a></li><li><a href="everoute.universe.SolarSystem.html">SolarSystem</a></li><li><a href="everoute.universe.SolarSystemExtension.html">SolarSystemExtension</a></li><li><a href="everoute.universe.SolarSystemExtensionData.html">SolarSystemExtensionData</a></li><li><a href="everoute.universe.Universe.html">Universe</a></li><li><a href="everoute.universe.UniverseBuilder.html">UniverseBuilder</a></li><li><a href="everoute.util.DefaultRandomizer.html">DefaultRandomizer</a></li><li><a href="everoute.util.Randomizer.html">Randomizer</a></li></ul><h3>Namespaces</h3><ul><li><a href="everoute.html">everoute</a></li><li><a href="everoute.travel.html">travel</a></li><li><a href="everoute.travel.capabilities.html">capabilities</a></li><li><a href="everoute.travel.capabilities.jumpGate.html">jumpGate</a></li><li><a href="everoute.travel.rules.html">rules</a></li><li><a href="everoute.travel.rules.security.html">security</a></li><li><a href="everoute.travel.rules.transitCount.html">transitCount</a></li><li><a href="everoute.travel.search.html">search</a></li><li><a href="everoute.universe.html">universe</a></li><li><a href="everoute.util.html">util</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Sat Jan 25 2014 20:36:04 GMT-0000 (GMT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
